<!doctype html>
<html>  
<head>
	<link rel="stylesheet" href="css/styles.css"/>
	<script src="js/jquery.min.js"></script>
	<script src="js/socket.js"></script>
 	<script src="/socket.io/socket.io.js"></script>
</head> 
 <body>    
 	<h1>ChatApp</h1> 
 	<ul id = 'log'></ul>
 	<form id="form">
 		<input id = "message" class = "text" placeholder= "Insert message here">
 		<button class="submit">Send</button>
 	</form>
 	<script>
 		var socket = io.connect('http://localhost:8000');
 		var usernames = [];
 		var name;

 		socket.on("share names", async function(names){
 			console.log(names);
 			usernames = await names;
 			console.log(usernames);
 			name = prompt("Please enter a username");
 			console.log(name);
 			verify_name();
 		});
 		
 		async function verify_name(){
			while(true){
				while(name == "" || name == "null"){
				 	name = prompt("Invalid username. Please try again");
				}
				console.log(usernames.includes(name));
				if(usernames.includes(name)){
					name = prompt("Username already in use. Please enter another username");
				}else{
					socket.emit("share name", name);
					break;
				}
			}
		}

		

		/*async function server_name_check(name){
		 	socket.emit("name check", name);
		 	await socket.on("name status", function(status){
		 		if(status == "unused"){
					return true;
		 		}else{
		 			return false;
		 		}
		 	});
	 	}*/
 		
 		
 		socket.on("message", function(message){
			$("#log").append($('<br>'));
			
			if(message.includes("<b>" + name + ": </b>")){
				$("#log").append($('<li class = "mine" >').html(message));
			}else{
				$("#log").append($('<li>').html(message));
			}

			$("#log").append($('<br>'));
		});

 		$("form").submit(function(e){
			e.preventDefault();
			socket.emit("chat message", "<b>" + name + ": </b>" + $("#message").val());
			$("#message").val("");
			return false;
		});

 	</script>
 </body>
 </html>